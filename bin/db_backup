#! /usr/bin/perl
# $Id: db_backup,v 1.2 2006/03/10 00:53:28 fred Exp $

use strict;

my $maxbackups = 10;
my $gz='gz';
my $mysqldump = '/usr/local/bin/mysqldump';
my $gzip = '/usr/bin/bzip2';

my $newfile;
my $filename = 'all_databases.sql';
my $curfile = $filename . ".$maxbackups";
unlink $curfile if -f $curfile;
my ($i, $j);
for ($i = $maxbackups - 2; $i >= 0; $i--) {
	$j = $i + 1;
	$curfile = $filename . '.' . $i;
	$newfile = $filename . '.' . $j;
	rename $curfile, $newfile if -f $curfile;
}
$curfile =     $filename . '.' . '0';
my $command = "$mysqldump --opt --all-databases | $gzip > $curfile";
my $result;
$result = system $command and warn "$result";
